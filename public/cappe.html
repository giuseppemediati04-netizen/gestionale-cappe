<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestionale Cappe</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>üè≠ Gestionale Cappe</h1>
            <p class="subtitle">Sistema di gestione inventario cappe aspirazione</p>
        </header>

        <div class="toolbar">
            <button id="btnDashboard" class="btn btn-primary" onclick="location.href='index.html'">üè† Dashboard</button>
            <button id="btnAggiungi" class="btn btn-primary">‚ûï Aggiungi Cappa</button>
            <button id="btnImport" class="btn btn-warning">üì§ Importa Excel</button>
            <button id="btnExport" class="btn btn-success">üìä Esporta Excel</button>
            <button id="btnRefresh" class="btn btn-info">üîÑ Aggiorna</button>
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="üîç Cerca per inventario, matricola, modello, sede...">
            </div>
        </div>

        <!-- Form Aggiungi/Modifica -->
        <div id="formModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2 id="formTitle">Aggiungi Nuova Cappa</h2>
                <form id="cappaForm">
                    <input type="hidden" id="cappaId">
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="inventario">Inventario *</label>
                            <input type="text" id="inventario" required>
                        </div>
                        <div class="form-group">
                            <label for="tipologia">Tipologia *</label>
                            <select id="tipologia" required onchange="toggleAltroInput(this)">
                                <option value="">Seleziona...</option>
                                <option value="Cappa biologica">Cappa biologica</option>
                                <option value="Cappa sterile">Cappa sterile</option>
                                <option value="Cappa chimica">Cappa chimica</option>
                                <option value="Cappa aspirante">Cappa aspirante</option>
                                <option value="Armadio">Armadio</option>
                                <option value="Altro">Altro</option>
                            </select>
                            <input type="text" id="tipologiaAltro" placeholder="Specifica tipologia..." style="display: none; margin-top: 8px;" class="form-control">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="matricola">Matricola *</label>
                            <input type="text" id="matricola" required>
                        </div>
                        <div class="form-group">
                            <label for="produttore">Produttore *</label>
                            <input type="text" id="produttore" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="modello">Modello *</label>
                            <input type="text" id="modello" required>
                        </div>
                        <div class="form-group">
                            <label for="sede">Sede *</label>
                            <input type="text" id="sede" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="reparto">Reparto *</label>
                            <input type="text" id="reparto" required>
                        </div>
                        <div class="form-group">
                            <label for="locale">Locale *</label>
                            <input type="text" id="locale" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="statoCorrettiva">Stato Correttiva</label>
                            <select id="statoCorrettiva">
                                <option value="Operativa">‚úÖ Operativa</option>
                                <option value="In Correttiva">‚ö†Ô∏è In Correttiva</option>
                                <option value="In Attesa Riparazione">üîß In Attesa Riparazione</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="dataManutenzione">Data Manutenzione</label>
                            <input type="date" id="dataManutenzione">
                        </div>
                        <div class="form-group">
                            <label for="dataProssimaManutenzione">Data Prossima Manutenzione</label>
                            <input type="date" id="dataProssimaManutenzione">
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üíæ Salva</button>
                        <button type="button" class="btn btn-secondary" id="btnAnnulla">‚ùå Annulla</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Modal Importa Excel -->
        <div id="importModal" class="modal">
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" id="closeImport">&times;</span>
                <h2>üì§ Importa Cappe da Excel</h2>
                
                <div class="import-instructions">
                    <h3>üìã Istruzioni:</h3>
                    <ol>
                        <li>Il file Excel deve avere queste colonne (intestazioni esatte):
                            <ul>
                                <li><strong>Inventario</strong></li>
                                <li><strong>Tipologia</strong></li>
                                <li><strong>Matricola</strong></li>
                                <li><strong>Produttore</strong></li>
                                <li><strong>Modello</strong></li>
                                <li><strong>Sede</strong></li>
                                <li><strong>Reparto</strong></li>
                                <li><strong>Locale</strong></li>
                                <li><strong>Data Manutenzione</strong> (opzionale, formato: gg/mm/aaaa)</li>
                                <li><strong>Data Prossima Manutenzione</strong> (opzionale, formato: gg/mm/aaaa)</li>
                            </ul>
                        </li>
                        <li>Tutti i campi tranne le date sono obbligatori</li>
                        <li>Le date devono essere nel formato: <strong>03/11/2025</strong></li>
                    </ol>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label><strong>Modalit√† di importazione:</strong></label>
                    <div style="margin: 10px 0;">
                        <label style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="radio" name="importMode" value="add" checked style="margin-right: 10px;">
                            <span><strong>Aggiungi solo nuove</strong> - Salta le cappe con matricola gi√† esistente</span>
                        </label>
                        <label style="display: flex; align-items: center;">
                            <input type="radio" name="importMode" value="replace" style="margin-right: 10px;">
                            <span><strong>Sostituisci esistenti</strong> - Aggiorna le cappe con stessa matricola</span>
                        </label>
                    </div>
                </div>

                <div class="form-group" style="margin-top: 20px;">
                    <label for="excelFile"><strong>Seleziona file Excel:</strong></label>
                    <input type="file" id="excelFile" accept=".xlsx,.xls" style="margin-top: 10px;">
                </div>

                <div class="form-actions" style="margin-top: 30px;">
                    <button type="button" class="btn btn-primary" id="btnStartImport">üì§ Importa</button>
                    <button type="button" class="btn btn-secondary" id="btnCancelImport">‚ùå Annulla</button>
                </div>

                <div id="importProgress" style="display: none; margin-top: 20px;">
                    <p style="text-align: center; font-weight: bold;">Importazione in corso...</p>
                    <div style="width: 100%; background: #ddd; border-radius: 5px; height: 20px;">
                        <div id="importProgressBar" style="width: 0%; background: #667eea; height: 100%; border-radius: 5px; transition: width 0.3s;"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tabella Cappe -->
        <div class="table-container">
            <table id="cappeTable">
                <thead>
                    <tr>
                        <th>Inventario</th>
                        <th>Tipologia</th>
                        <th>Matricola</th>
                        <th>Produttore</th>
                        <th>Modello</th>
                        <th>Sede</th>
                        <th>Reparto</th>
                        <th>Locale</th>
                        <th>Stato</th>
                        <th>Ult. Manutenzione</th>
                        <th>Pross. Manutenzione</th>
                        <th>Azioni</th>
                    </tr>
                </thead>
                <tbody id="cappeTableBody">
                    <tr>
                        <td colspan="11" class="loading">Caricamento dati...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <div id="stats" class="stats">
            <div class="stat-card">
                <h3>Totale Cappe</h3>
                <p id="totalCappe">0</p>
            </div>
            <div class="stat-card">
                <h3>Manutenzioni Scadute</h3>
                <p id="manutenzioniScadute">0</p>
            </div>
            <div class="stat-card">
                <h3>Manutenzioni Prossime (30gg)</h3>
                <p id="manutenzioniProssime">0</p>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <script src="app.js"></script>
</body>
</html>
